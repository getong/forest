<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mainnet compatibility</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic_usage.html"><strong aria-hidden="true">1.1.</strong> Basic Usage</a></li><li class="chapter-item expanded "><a href="../cli.html"><strong aria-hidden="true">1.2.</strong> Command-line interface</a></li><li class="chapter-item expanded "><a href="../wallet.html"><strong aria-hidden="true">1.3.</strong> Wallet handling</a></li><li class="chapter-item expanded "><a href="../configuration.html"><strong aria-hidden="true">1.4.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../environment_variables.html"><strong aria-hidden="true">1.5.</strong> Environment Variables</a></li><li class="chapter-item expanded "><a href="../docker.html"><strong aria-hidden="true">1.6.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../healthcheck.html"><strong aria-hidden="true">1.7.</strong> Healthcheck</a></li><li class="chapter-item expanded "><a href="../snapshot_export.html"><strong aria-hidden="true">1.8.</strong> Snapshot exporting</a></li><li class="chapter-item expanded "><a href="../jsonrpc.html"><strong aria-hidden="true">1.9.</strong> JSON-RPC API</a></li><li class="chapter-item expanded "><a href="../backups.html"><strong aria-hidden="true">1.10.</strong> Backups</a></li><li class="chapter-item expanded "><a href="../trouble_shooting.html"><strong aria-hidden="true">1.11.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">1.12.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="../bootstrap_node.html"><strong aria-hidden="true">1.13.</strong> Bootstrap node</a></li><li class="chapter-item expanded "><a href="../offline-forest.html"><strong aria-hidden="true">1.14.</strong> Offline Forest</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Developer documentation</li><li class="chapter-item expanded "><a href="../developer_documentation/introduction.html"><strong aria-hidden="true">2.</strong> Developer documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developer_documentation/application_architecture.html"><strong aria-hidden="true">2.1.</strong> Application architecture</a></li><li class="chapter-item expanded "><a href="../developer_documentation/contributing.html"><strong aria-hidden="true">2.2.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="../developer_documentation/database_migrations.html"><strong aria-hidden="true">2.3.</strong> Database migrations</a></li><li class="chapter-item expanded "><a href="../developer_documentation/local_actions.html"><strong aria-hidden="true">2.4.</strong> Local GH Actions</a></li><li class="chapter-item expanded "><a href="../developer_documentation/mainnet_compatibility.html" class="active"><strong aria-hidden="true">2.5.</strong> Mainnet compatibility</a></li><li class="chapter-item expanded "><a href="../developer_documentation/memory-analysis.html"><strong aria-hidden="true">2.6.</strong> Memory analysis</a></li><li class="chapter-item expanded "><a href="../developer_documentation/release_checklist.html"><strong aria-hidden="true">2.7.</strong> Release checklist</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration.html"><strong aria-hidden="true">2.8.</strong> State migration</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration_guide.html"><strong aria-hidden="true">2.9.</strong> State migration guide</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration_spike.html"><strong aria-hidden="true">2.10.</strong> State migration spike NV17-NV18</a></li><li class="chapter-item expanded "><a href="../developer_documentation/test_plan.html"><strong aria-hidden="true">2.11.</strong> Test plan</a></li><li class="chapter-item expanded "><a href="../developer_documentation/devnet_notes.html"><strong aria-hidden="true">2.12.</strong> Devnet Notes</a></li><li class="chapter-item expanded "><a href="../developer_documentation/archie_and_fuzzy.html"><strong aria-hidden="true">2.13.</strong> Archie and Fuzzy</a></li><li class="chapter-item expanded "><a href="../developer_documentation/rpc_api_compatibility.html"><strong aria-hidden="true">2.14.</strong> RPC API Compatibility</a></li><li class="chapter-item expanded "><a href="../developer_documentation/notes_and_sketches.html"><strong aria-hidden="true">2.15.</strong> Notes and sketches</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developer_documentation/chain_muxer_state_machine.html"><strong aria-hidden="true">2.15.1.</strong> ChainMuxer/TipsetProcessor state machine</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="testing-for-mainnet-compatibility"><a class="header" href="#testing-for-mainnet-compatibility">Testing for Mainnet Compatibility</a></h1>
<p>Forest development can be like hitting a moving target and sometimes Forest
falls behind the network. This document should serve as a way to easily identify
if Forest can sync all the way up to the network head using a simple
step-by-step process.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>Some command-line tools and software is required to follow this guide.</p>
<ul>
<li>A fresh copy of the Forest repository that has been built</li>
<li>Lotus installed</li>
<li>curl (to download snapshots)</li>
<li>sha256sum (optional, used to verify snapshot integrity)</li>
</ul>
<h2 id="grab-a-snapshot-and-run-forest"><a class="header" href="#grab-a-snapshot-and-run-forest">Grab a snapshot and run Forest</a></h2>
<p>Refer to the mdbook documentation on how to download a snapshot and run forest</p>
<p>Warning: FileCoin snapshots as of this writing are over 75GB. Verify you have
enough space on your system to accommodate these large files.</p>
<ul>
<li>Use <code>make mdbook</code> in Forest's root directory</li>
<li>Open <code>http://localhost:3000</code></li>
<li>Navigate to <code>2. Basic Usage</code> in the menu on the right</li>
<li>Scroll down to <code>Forest Import Snapshot Mode</code></li>
</ul>
<h2 id="let-forest-sync"><a class="header" href="#let-forest-sync">Let Forest sync</a></h2>
<p>This step may take a while. We want Forest to get as far along in the syncing
process as it can get. If it syncs up all the way to the network head, CONGRATS!
Forest is up to date and on mainnet. Otherwise, Forest is not on mainnet.</p>
<p>If Forest starts to error and can't get past a block while syncing. Make note of
which block it is. We can use that block to help debug any potential state
mismatches.</p>
<h2 id="is-forest-on-the-latest-network-version"><a class="header" href="#is-forest-on-the-latest-network-version">Is Forest on the latest network version?</a></h2>
<p>Something easy to check is if Forest is on the latest Filecoin network version.
A repository exists where we can see all of the released network versions
<a href="https://github.com/filecoin-project/tpm/tree/master/Network%20Upgrades">here</a>.
Navigate the codebase to see mention of the latest network upgrade. If a
snapshot fails to sync at a certain epoch, it's entirely possible that the
snapshot was behind an epoch when a version upgrade started. Grab a new snapshot
by referring to the mdbook documentation.</p>
<h2 id="debugging-state-mismatches"><a class="header" href="#debugging-state-mismatches">Debugging State Mismatches</a></h2>
<p>Statediffs can only be printed if we import a snapshot containing the stateroot
data from Lotus. This means there will not be a pretty statediff if Forest is
already synced to the network when the stateroot mismatch happens. By default,
snapshots only contain stateroot data for the previous 2000 epochs. So, if you
have a statediff at epoch X, download a snapshot for epoch X+100 and tell Forest
to re-validate the snapshot from epoch X.</p>
<p>Steps to print a state-diff:</p>
<ol>
<li>Note the epoch of the state-root mismatch. State-roots can only be checked
for the parents of a tipset so the failing epoch may be 1 higher than you
think.</li>
<li>Download a recent snapshot dated <em>before</em> the failing epoch.</li>
<li>Import the snapshot into Lotus and sync to HEAD.</li>
<li>Export a new snapshot 100 epochs <em>after</em> the failing epoch.</li>
<li>Convert the <code>.car.zst</code> file to <code>.forest.car.zst</code> with:
<code>forest-tool snapshot compress {snapshot.car.zst}</code></li>
<li>Use the <code>forest-tool</code> binary to print the state-diff:
<code>forest-tool archive diff {snapshot.forest.car.zst} --epoch {failing_epoch}</code></li>
</ol>
<h2 id="fvm-traces"><a class="header" href="#fvm-traces">FVM Traces</a></h2>
<p>Within FVM, we can enable tracing to produce execution traces. Given an
offending epoch, we can produce them both for Forest and for Lotus to find
mismatches.</p>
<p>To confirm: the execution traces format is not uniform across implementations,
so it takes a certain amount of elbow grease to find the differences. Lotus is
capable of spitting this out in JSON for nice UX</p>
<h2 id="dated-resources"><a class="header" href="#dated-resources">Dated resources</a></h2>
<p>For more (but dated) information, see
<a href="https://www.notion.so/chainsafe/Interop-debugging-6adabf9222d7449bbfeaacb1ec997cf8">this document.</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../developer_documentation/local_actions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../developer_documentation/memory-analysis.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../developer_documentation/local_actions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../developer_documentation/memory-analysis.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
