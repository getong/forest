<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Offline Forest</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basic_usage.html"><strong aria-hidden="true">1.1.</strong> Basic Usage</a></li><li class="chapter-item expanded "><a href="cli.html"><strong aria-hidden="true">1.2.</strong> Command-line interface</a></li><li class="chapter-item expanded "><a href="wallet.html"><strong aria-hidden="true">1.3.</strong> Wallet handling</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">1.4.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="environment_variables.html"><strong aria-hidden="true">1.5.</strong> Environment Variables</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">1.6.</strong> Docker</a></li><li class="chapter-item expanded "><a href="healthcheck.html"><strong aria-hidden="true">1.7.</strong> Healthcheck</a></li><li class="chapter-item expanded "><a href="snapshot_export.html"><strong aria-hidden="true">1.8.</strong> Snapshot exporting</a></li><li class="chapter-item expanded "><a href="jsonrpc.html"><strong aria-hidden="true">1.9.</strong> JSON-RPC API</a></li><li class="chapter-item expanded "><a href="backups.html"><strong aria-hidden="true">1.10.</strong> Backups</a></li><li class="chapter-item expanded "><a href="trouble_shooting.html"><strong aria-hidden="true">1.11.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="glossary.html"><strong aria-hidden="true">1.12.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="bootstrap_node.html"><strong aria-hidden="true">1.13.</strong> Bootstrap node</a></li><li class="chapter-item expanded "><a href="offline-forest.html" class="active"><strong aria-hidden="true">1.14.</strong> Offline Forest</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Developer documentation</li><li class="chapter-item expanded "><a href="developer_documentation/introduction.html"><strong aria-hidden="true">2.</strong> Developer documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_documentation/application_architecture.html"><strong aria-hidden="true">2.1.</strong> Application architecture</a></li><li class="chapter-item expanded "><a href="developer_documentation/contributing.html"><strong aria-hidden="true">2.2.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="developer_documentation/database_migrations.html"><strong aria-hidden="true">2.3.</strong> Database migrations</a></li><li class="chapter-item expanded "><a href="developer_documentation/local_actions.html"><strong aria-hidden="true">2.4.</strong> Local GH Actions</a></li><li class="chapter-item expanded "><a href="developer_documentation/mainnet_compatibility.html"><strong aria-hidden="true">2.5.</strong> Mainnet compatibility</a></li><li class="chapter-item expanded "><a href="developer_documentation/memory-analysis.html"><strong aria-hidden="true">2.6.</strong> Memory analysis</a></li><li class="chapter-item expanded "><a href="developer_documentation/release_checklist.html"><strong aria-hidden="true">2.7.</strong> Release checklist</a></li><li class="chapter-item expanded "><a href="developer_documentation/state_migration.html"><strong aria-hidden="true">2.8.</strong> State migration</a></li><li class="chapter-item expanded "><a href="developer_documentation/state_migration_guide.html"><strong aria-hidden="true">2.9.</strong> State migration guide</a></li><li class="chapter-item expanded "><a href="developer_documentation/state_migration_spike.html"><strong aria-hidden="true">2.10.</strong> State migration spike NV17-NV18</a></li><li class="chapter-item expanded "><a href="developer_documentation/test_plan.html"><strong aria-hidden="true">2.11.</strong> Test plan</a></li><li class="chapter-item expanded "><a href="developer_documentation/devnet_notes.html"><strong aria-hidden="true">2.12.</strong> Devnet Notes</a></li><li class="chapter-item expanded "><a href="developer_documentation/archie_and_fuzzy.html"><strong aria-hidden="true">2.13.</strong> Archie and Fuzzy</a></li><li class="chapter-item expanded "><a href="developer_documentation/rpc_api_compatibility.html"><strong aria-hidden="true">2.14.</strong> RPC API Compatibility</a></li><li class="chapter-item expanded "><a href="developer_documentation/notes_and_sketches.html"><strong aria-hidden="true">2.15.</strong> Notes and sketches</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_documentation/chain_muxer_state_machine.html"><strong aria-hidden="true">2.15.1.</strong> ChainMuxer/TipsetProcessor state machine</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="offline-forest"><a class="header" href="#offline-forest">Offline Forest</a></h1>
<p>Forest offers an offline mode, allowing using the snapshot as the source of
chain data and not connecting to any peers. This is useful for querying the
chain's archive state without syncing, and various testing scenarios.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<pre><code class="language-bash">❯ forest-tool api serve --help
Usage: forest-tool api serve [OPTIONS] [SNAPSHOT_FILES]...

Arguments:
  [SNAPSHOT_FILES]...  Snapshot input paths. Supports `.car`, `.car.zst`, and `.forest.car.zst`

Options:
      --chain &lt;CHAIN&gt;           Filecoin network chain [default: mainnet]
      --port &lt;PORT&gt;             [default: 2345]
      --auto-download-snapshot
      --height &lt;HEIGHT&gt;         Validate snapshot at given EPOCH, use a negative value -N to validate the last N EPOCH(s) starting at HEAD [default: -50]
      --genesis &lt;GENESIS&gt;       Genesis file path, only applicable for devnet
  -h, --help                    Print help
</code></pre>
<h2 id="example-serving-a-calibnet-snapshot"><a class="header" href="#example-serving-a-calibnet-snapshot">Example: serving a calibnet snapshot</a></h2>
<p>The following command will start an offline server using the latest available
snapshot, which will be downloaded automatically. The server will listen on the
default port and act as a calibnet node <em>stuck</em> at the latest snapshot's height.</p>
<pre><code class="language-bash">forest-tool api serve --chain calibnet --auto-download-snapshot
</code></pre>
<h2 id="example-serving-a-custom-snapshot-on-calibnet"><a class="header" href="#example-serving-a-custom-snapshot-on-calibnet">Example: serving a custom snapshot on calibnet</a></h2>
<p>The following command will start an offline server using a custom snapshot,
which will be loaded from the provided path. The server will listen on the
default port and act as a calibnet node <em>stuck</em> at the snapshot's
height: 1859736.</p>
<pre><code class="language-bash">❯ forest-tool api serve --chain calibnet ~/Downloads/forest_snapshot_calibnet_2024-08-08_height_1859736.forest.car.zst
2024-08-12T12:29:16.624698Z  INFO forest_filecoin::tool::offline_server::server: Configuring Offline RPC Server
2024-08-12T12:29:16.640402Z  INFO forest_filecoin::tool::offline_server::server: Using chain config for calibnet
2024-08-12T12:29:16.641654Z  INFO forest_filecoin::genesis: Initialized genesis: bafy2bzacecyaggy24wol5ruvs6qm73gjibs2l2iyhcqmvi7r7a4ph7zx3yqd4
2024-08-12T12:29:16.643263Z  INFO forest_filecoin::daemon::db_util: Populating column EthMappings from range: [322354, 1859736]
...
2024-08-12T12:29:44.218675Z  INFO forest_filecoin::tool::offline_server::server: Starting offline RPC Server
2024-08-12T12:29:44.218804Z  INFO forest_filecoin::rpc: Ready for RPC connections
</code></pre>
<p>The server can then be queried using <code>forest-cli</code> or raw requests.</p>
<pre><code class="language-bash">❯ curl --silent -X POST -H "Content-Type: application/json" \
             --data '{"jsonrpc":"2.0","id":2,"method":"Filecoin.ChainHead","param":"null"}' \
             "http://127.0.0.1:2345/rpc/v0" | jq
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "Cids": [
      {
        "/": "bafy2bzaceafill2bfzjwfq7o5x5idqe2odrriz5n4pup5xfrbsdrzjsa6mspk"
      }
    ],
    "Blocks": [
      {
      ...
      }
    ],
    "Height": 1859736
  }
}
</code></pre>
<h2 id="example-usage-on-a-devnet"><a class="header" href="#example-usage-on-a-devnet">Example: usage on a devnet</a></h2>
<p>The devnet case is a bit more complex, as the genesis file and the network name
need to be provided. If no snapshots are provided, the server will start at the
genesis block.</p>
<pre><code class="language-bash">forest-tool api serve --chain localnet-55c7758d-c91a-41eb-94a2-718cb4601bc5 --genesis /lotus_data/devgen.car
</code></pre>
<p>The server can be later queried:</p>
<pre><code class="language-bash">❯ curl --silent -X POST -H "Content-Type: application/json" \
             --data '{"jsonrpc":"2.0","id":2,"method":"Filecoin.StateGetNetworkParams","param":"null"}' \
             "http://127.0.0.1:2345/rpc/v0" | jq
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "NetworkName": "localnet-55c7758d-c91a-41eb-94a2-718cb4601bc5",
    "BlockDelaySecs": 4,
    "ConsensusMinerMinPower": "2040",
    "SupportedProofTypes": [
      0,
      1
    ],
    "PreCommitChallengeDelay": 10,
    "ForkUpgradeParams": {
      "UpgradeSmokeHeight": -2,
      ...
      "UpgradeWaffleHeight": 18
    },
    "Eip155ChainID": 31415926
  }
}
</code></pre>
<p>Note that the network name will vary depending on the genesis file used.</p>
<p>⚠️ The offline server is unable to append blocks to the chain at the moment of
writing. See <a href="https://github.com/ChainSafe/forest/issues/4598">#4598</a> for
details and updates. This means that starting the server only with a genesis
file won't be very useful, as the chain will be stuck at the genesis block.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="bootstrap_node.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="developer_documentation/introduction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="bootstrap_node.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="developer_documentation/introduction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
